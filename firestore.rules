rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- GENEL KURALLAR ---
    
    // Ürünleri herkes görebilir, sadece admin düzenleyebilir
    match /products/{productId} {
      allow read: if true;
      allow write: if false; // Yazma işlemleri sadece Admin SDK üzerinden
    }

    // Kategoriler herkese açık
    match /categories/{categoryId} {
      allow read: if true;
      allow write: if false;
    }
    
    // Şehirler herkese açık
    match /cities/{cityId} {
      allow read: if true;
      allow write: if false;
    }

    // --- SİPARİŞ GÜVENLİĞİ ---

    match /orders/{orderId} {
      // 1. Oluşturma (Create): Herkes sipariş verebilir (Guest Checkout dahil)
      // Ancak gelen veriyi doğrulama (Validation) eklenebilir.
      allow create: if true;

      // 2. Okuma/Listeleme (Read): KAPALI ⛔
      // Müşteri verileri Client-Side SDK ile okunamaz.
      // Okuma işlemleri Next.js API Routes (/api/orders) üzerinden yapılmalıdır.
      // API Route, Admin SDK kullanarak bu kuralları bypass eder.
      allow read: if false;

      // 3. Güncelleme/Silme (Update/Delete): KAPALI ⛔
      // Sadece Admin paneli API üzerinden işlem yapabilir.
      allow update, delete: if false;
    }

    // Bilinmeyen diğer tüm koleksiyonlar kapalı
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
